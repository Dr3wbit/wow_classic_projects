{% load static %}

<link rel="stylesheet" type="text/css" href="{% static "css/save_form.css" %}">

<div class="row saveBlock">
        <h1 class="saveTitle col-12">SAVE</h1>
    <div class="container">
    <form method="post">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="fieldWrapper row">
            {{ form.tags.errors }}
            <label class="col-2"for="{{ form.tags.id_for_label }}">Tags:</label>
            <div class="col-10 left-align">
                    {% for checkbox in form.tags %}
                    <span class="checkbox">{{checkbox}}</span>
                    {% endfor %}
            </div>
        </div>

        <div class="fieldWrapper">

        {% if "talent_calc" in request.path %}
            <span>
                <label id="wow_class_label" class="{{selected}}" for="id_wow_class">{{selected|title}}</label>
                <input id="wow_class" type="hidden" value="{{selected}}" name="wow_class">
            </span>
            <span>
                <label id="talents_spent" for="id_spent">(0/0/0)</label>
                <input class="tree-input" id="tree0" type="hidden" value="Arms,10" name="spent">
            </span>
            <span>
                <input class="tree-input" id="tree1" type="hidden" value="Fury,15" name="spent">
            </span>
            <span>
                <input class="tree-input" id="tree2" type="hidden" value="Protection,10" name="spent">
            </span>
        {% else %}
        <div id="all_consumes">
        </div>
        {% endif %}
        </div>

        <div class="fieldWrapper row">
            {{ form.name.errors }}
            <label class="col-2" for="{{ form.name.id_for_label }}">Title:</label>
            <div class="col-8 p-0">
                    {{ form.name }}
            </div>
            <div class="col-2"></div>
        </div>
        <div class="fieldWrapper row">
            {{ form.description.errors }}
            <label class="col-2" for="{{ form.description.id_for_label }}">Notes:</label>
            <div class="col-8 p-0">
                    {{ form.description }}
            </div>
            <div class="col-2"></div>
        </div>
        <div class="fieldWrapper row justify-content-center">
            <div class="privateSelect col-12">
                    {{ form.private.errors }}
                    {{ form.private }}
                    <label for="{{ form.private.id_for_label }}">Private?</label>
            </div>
        </div>
        <div class="fieldWrapper row">
            <input id="list_hash" type="hidden" value="test" name="hash">
        </div>


        <div class="form-actions row justify-content-center">
            {% if "talent_calc" in request.path %}
            <button id="save_spec" class="btn btn-lg btn-dark pl-5 pr-5 mb-4"type="submit">Save</button>
            {% else %}
            <button id="save_consume_list" class="btn btn-lg btn-dark pl-5 pr-5 mb-4"type="submit">Save</button>
            {% endif %}
        </div>
    </form>
</div>
</div>

<script>
$('#save_spec').on({
	click: e=> {
		var tree_inputs = $(".tree-input")
        $("#tree0").val(`${talentPointsSpent.treeNames[0]},${talentPointsSpent[talentPointsSpent.treeNames[0]].total()}`)
        $("#tree1").val(`${talentPointsSpent.treeNames[1]},${talentPointsSpent[talentPointsSpent.treeNames[1]].total()}`)
        $("#tree2").val(`${talentPointsSpent.treeNames[2]},${talentPointsSpent[talentPointsSpent.treeNames[2]].total()}`)
		$("#list_hash").val(urlBuilder())
	    $('#save_list').submit();
	},
});

$('#save_consume_list').on({
	click: e=> {
        let spent = []
        var all_consumes = $("#all_consumes")

        for (let [profname, v] of Object.entries(my_consume_list)) {
            for (let [crafted, amount] of Object.entries(v)) {
                all_consumes.append($('<input/>', {
                    name:"spent",
                    value: `${crafted},${amount}`,
                    type: 'hidden'
                }
            ))
            }
        }
	    $('#save_consume_list').submit();
	},
});

</script>
